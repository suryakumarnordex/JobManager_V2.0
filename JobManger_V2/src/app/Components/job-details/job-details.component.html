<div class="main-container">
  <app-job-header
    [jobCountLength]="this.JobDetailsLocalVariable.jobCount"
    [priorityDisable]="this.priorityDisable"
    [requeueDisable]="this.requeueDisable"
    [cancelDisable]="this.cancelDisable"
    [submitDisable]="this.submitDisable"
    [countdown]="this.JobDetailsLocalVariable.countdown"
    [timedOut]="this.JobDetailsLocalVariable.timedOut"
  ></app-job-header>

  <clr-datagrid
    [(clrDgSelected)]="this.JobDetailsLocalVariable.CheckboxofJobRow"
    class="datagrid-compact"
    id="gridstyle"
    HorizontalAlignment="auto"
    VerticalAlignment="auto"
    (clrDgRefresh)="Columnfilters($event)"
    [clrDgLoading]="this.JobDetailsLocalVariable.dataloading"
    (clrDgSelectedChange)="selectionChanged($event)"
  >
     
    <clr-dg-column
      [style.width.px]="JobDetailsLocalStorage.idcolumnWidthValue"
      [clrDgField]="'jobIdFragment'"
      (clrDgColumnResize)="ColumnResized($event, 'idcolumnwidth')"
      ><ng-container *clrDgHideableColumn="{ hidden: false }">ID</ng-container> 
         
    </clr-dg-column>

    <clr-dg-column
      [style.width.px]="JobDetailsLocalStorage.usercolumnWidthValue"
      [clrDgField]="'userFragment'"
      (clrDgColumnResize)="ColumnResized($event, 'usercolumnwidth')"
    >
      <ng-container *clrDgHideableColumn="{ hidden: false }">
        User
      </ng-container>
      <clr-dg-filter [clrDgFilter]="cockpitusernameFilter" [scrollLeft]="true">
        <checkbox-list-filter
          [id]="cockpitusernameFilter"
          #cockpitusernameFilter
          [filterParamName]="'userFragment'"
          [items]="JobDetailsLocalVariable.AvailableUserName"
        ></checkbox-list-filter>
      </clr-dg-filter>
    </clr-dg-column>
    <clr-dg-column
      [style.width.px]="JobDetailsLocalStorage.cockpitcolumnWidthValue"
      [clrDgField]="'cockpitIdFragment'"
      (clrDgColumnResize)="ColumnResized($event, 'cockpitcolumnwidth')"
      ><ng-container *clrDgHideableColumn="{ hidden: false }"
        >Cockpit Id</ng-container
      ></clr-dg-column
    >
    <clr-dg-column
      [style.width.px]="JobDetailsLocalStorage.runcolumnWidthValue"
      [clrDgField]="'runnoFragment'"
      (clrDgColumnResize)="ColumnResized($event, 'runcolumnwidth')"
      ><ng-container *clrDgHideableColumn="{ hidden: false }"
        >Run</ng-container
      ></clr-dg-column
    >
    <clr-dg-column
      [style.width.px]="JobDetailsLocalStorage.typecolumnWidthValue"
      [clrDgField]="'typeFragment'"
      (clrDgColumnResize)="ColumnResized($event, 'typecolumnwidth')"
    >
      <clr-dg-filter [clrDgFilter]="typeFilter" [scrollLeft]="true">
        <checkbox-list-filter
          [id]="typeFilter"
          #typeFilter
          [filterParamName]="'typeFragment'"
          [items]="JobDetailsLocalVariable.AvailableType"
        ></checkbox-list-filter>
      </clr-dg-filter>
      <ng-container *clrDgHideableColumn="{ hidden: false }"
        >Type</ng-container
      ></clr-dg-column
    >
    <clr-dg-column
      [style.width.px]="JobDetailsLocalStorage.topiccolumnWidthValue"
      [clrDgField]="'topicFragment'"
      (clrDgColumnResize)="ColumnResized($event, 'topiccolumnwidth')"
    >
      <ng-container *clrDgHideableColumn="{ hidden: false }"
        >Topic</ng-container
      ></clr-dg-column
    >
    <clr-dg-column
      [style.width.px]="JobDetailsLocalStorage.statuscolumnWidthValue"
      [clrDgField]="'statusFragment'"
      (clrDgColumnResize)="ColumnResized($event, 'statuscolumnwidth')"
    >
      <clr-dg-filter [clrDgFilter]="statusFilter" [scrollLeft]="true">
        <checkbox-list-filter
          [id]="statusFilter"
          #statusFilter
          [filterParamName]="'statusFragment'"
          [items]="JobDetailsLocalVariable.AvailableState"
        ></checkbox-list-filter>
      </clr-dg-filter>
      <ng-container *clrDgHideableColumn="{ hidden: false }"
        >Status</ng-container
      ></clr-dg-column
    >
    <clr-dg-column
      [style.width.px]="JobDetailsLocalStorage.progresscolumnWidthValue"
      (clrDgColumnResize)="ColumnResized($event, 'progresscolumnwidth')"
    >
      <ng-container *clrDgHideableColumn="{ hidden: false }"
        >Progress</ng-container
      ></clr-dg-column
    >
    <clr-dg-column
      [style.width.px]="JobDetailsLocalStorage.prioritycolumnWidthValue"
      [clrDgField]="'priorityFragment'"
      (clrDgColumnResize)="ColumnResized($event, 'prioritycolumnwidth')"
    >
      <ng-container *clrDgHideableColumn="{ hidden: false }"
        >Job Priority</ng-container
      ></clr-dg-column
    >
    <clr-dg-column
      [style.width.px]="JobDetailsLocalStorage.notaskcolumnWidthValue"
      [clrDgField]="'numberOfTasksFragment'"
      (clrDgColumnResize)="ColumnResized($event, 'notaskcolumnwidth')"
      ><ng-container *clrDgHideableColumn="{ hidden: false }"
        >Number of Tasks</ng-container
      ></clr-dg-column
    >
    <clr-dg-column
      [style.width.px]="JobDetailsLocalStorage.runningTaskcolumnWidthValue"
      (clrDgColumnResize)="ColumnResized($event, 'runningTaskcolumnwidth')"
      ><ng-container *clrDgHideableColumn="{ hidden: false }"
        >Running Tasks</ng-container
      ></clr-dg-column
    >
    <clr-dg-column
      [style.width.px]="JobDetailsLocalStorage.queuedTaskcolumnWidthValue"
      (clrDgColumnResize)="ColumnResized($event, 'queuedTaskcolumnwidth')"
      ><ng-container *clrDgHideableColumn="{ hidden: false }"
        >Queued Tasks</ng-container
      ></clr-dg-column
    >
    <clr-dg-column
      [style.width.px]="JobDetailsLocalStorage.starttimecolumnWidthValue"
      (clrDgColumnResize)="ColumnResized($event, 'starttimecolumnwidth')"
      ><ng-container *clrDgHideableColumn="{ hidden: false }"
        >Start Time (yy/mm/dd HH:mm)
      </ng-container></clr-dg-column
    >
    <clr-dg-column
      [style.width.px]="JobDetailsLocalStorage.endtimecolumnWidthValue"
      (clrDgColumnResize)="ColumnResized($event, 'endtimecolumnwidth')"
      ><ng-container *clrDgHideableColumn="{ hidden: false }"
        >End Time (yy/mm/dd HH:mm)
      </ng-container></clr-dg-column
    >
    <clr-dg-column
      [style.width.px]="JobDetailsLocalStorage.submittimecolumnWidthValue"
      (clrDgColumnResize)="ColumnResized($event, 'submittimecolumnwidth')"
      ><ng-container *clrDgHideableColumn="{ hidden: false }"
        >Submit Time (yy/mm/dd HH:mm)
      </ng-container></clr-dg-column
    >
    <clr-dg-column
      [style.width.px]="JobDetailsLocalStorage.elapsedtimecolumnWidthValue"
      (clrDgColumnResize)="ColumnResized($event, 'elapsedtimecolumnwidth')"
      ><ng-container *clrDgHideableColumn="{ hidden: false }"
        >Elapsed Time (HH:mm:ss)</ng-container
      ></clr-dg-column
    >

    <clr-dg-row
      style="word-break: break-all"
      *ngFor="let job of this.JobDetailsLocalVariable.Joblayout"
      [clrDgItem]="job"
      class="align"
    >
      <clr-dg-action-overflow>
        <button
          [disabled]="this.priorityDisable"
          class="action-item"
          (click)="openmodel('Priority', job.jobIdFragment)"
        >
          Priority
        </button>
        <button
          [disabled]="this.requeueDisable"
          class="action-item"
          (click)="openmodel('Requeue', job.jobIdFragment)"
        >
          Requeue
        </button>
        <!-- pending reason -->
        <!-- <button
          [disabled]="true"
          class="action-item"
          (click)="openmodel('Pending_Reason', job.jobIdFragment)"
        >
          Pending Reason
        </button> -->
        <!-- Ends -->
        <button
          [disabled]="this.cancelDisable"
          class="action-item"
          (click)="openmodel('Cancel', job.jobIdFragment)"
        >
          Cancel
        </button>
        <button
          [disabled]="this.submitDisable"
          class="action-item"
          (click)="openmodel('Submit', job.jobIdFragment)"
        >
          Submit
        </button>
      </clr-dg-action-overflow>
      <!-- <clr-dg-cell id="cellstyle">{{
        job.jobIdFragment
      }}</clr-dg-cell> -->
      <clr-dg-cell id="cellstyle">
        <span
          title=" Type : {{ job.typeFragment }}&#013;Topic : {{
            job.topicFragment
          }} "
          >{{ job.jobIdFragment }}
        </span>
      </clr-dg-cell>
      <clr-dg-cell [style.width.px]="300" id="cellstyle"
        ><div class="hidden">
          <span title="{{ job.userFragment }}">{{ job.userFragment }} </span>
        </div></clr-dg-cell
      >
      <clr-dg-cell [style.width.px]="300" id="cellstyle">
        <div class="clipboards">
          <div>
            <div
              role="tooltip"
              aria-haspopup="true"
              class="tooltip tooltip-sm tooltip tooltip-right"
            >
              {{ job.cockpitIdFragment }}
              <!-- <span class="tooltip-content">{{ job.cockpitIdFragment }} </span> -->
            </div>
          </div>
          <div>
            <div (click)="CopyClipboard(false, job)">
              <a
                href="javascript:void(0)"
                role="tooltip"
                aria-haspopup="true"
                class="tooltip tooltip-sm tooltip tooltip-right"
              >
                <clr-icon
                  shape="copy-to-clipboard"
                  class="is-solid has-badge-info"
                  *ngIf="job.cockpitIdFragment != undefined"
                ></clr-icon>
                <span class="tooltip-content">{{ job.project }}</span>
              </a>
            </div>
          </div>
        </div>
      </clr-dg-cell>

      <clr-dg-cell [style.width.px]="800" id="cellstyle">
        <div class="clipboards">
          <span title="{{ job.runnoFragment }}">
            <a
              href="{{
                'http://ldms.nordex-ag.com/NXplore2/data?projectId=498&run=' +
                  job.runnoFragment
              }}"
              target="_blank"
              >{{ job.runnoFragment | slice : 0 : 5 }}</a
            >
          </span>
          <div>
            <div (click)="CopyClipboard(true, job)">
              <a
                href="javascript:void(0)"
                role="tooltip"
                aria-haspopup="true"
                class="tooltip tooltip-sm tooltip tooltip-right"
              >
                <clr-icon
                  shape="copy-to-clipboard"
                  class="is-solid has-badge-info"
                  *ngIf="job.runFolderFragment != undefined"
                ></clr-icon>
                <span class="tooltip-content">{{ job.runFolderFragment }}</span>
              </a>
            </div>
          </div>
        </div>
      </clr-dg-cell>

      <clr-dg-cell [style.width.px]="500" id="cellstyle">
        <div class="hidden">
          <span title="{{ job.typeFragment }}">{{ job.typeFragment }} </span>
        </div></clr-dg-cell
      >
      <clr-dg-cell [style.width.px]="800" id="cellstyle">
        <div class="hidden">
          <span title="{{ job.topicFragment }}">{{ job.topicFragment }} </span>
        </div>
      </clr-dg-cell>
      <clr-dg-cell
        [style.color]="
          job.statusFragment == 'Failed'
            ? 'red'
            : job.statusFragment == 'Running'
            ? 'blue'
            : job.statusFragment == 'Finished'
            ? 'green'
            : job.statusFragment == 'Canceled'
            ? 'orange'
            : job.statusFragment == 'Queued'
            ? 'Magenta'
            : 'black'
        "
        >{{ job.statusFragment }}</clr-dg-cell
      >

      <clr-dg-cell
        [style.width.px]="300"
        style="text-align: left; min-width: 113px"
      >
        <h6 *ngIf="job.failedTasksCount > 0" class="badge badge-danger">
          {{ job.failedTasksCount }}
        </h6>
        <a
          href="javascript:void(0)"
          role="tooltip"
          aria-haspopup="true"
          class="tooltip tooltip-sm tooltip tooltip-right"
        >
          <clr-progress-bar
            [clrValue]="job.progressFragment"
            [clrLabeled]="true"
            [style.width.px]="100"
          >
          </clr-progress-bar>
          <span class="tooltip-content">
            Running:{{ job.runningTasksCount }}
            <br />
            <span class="tooltip-content">
              Finished:{{ job.finishedTasksCount }}&nbsp;({{
                (job.finishedTasksCount / job.numberOfTasksFragment) * 100
                  | number : "1.0-0"
              }}%)
            </span>
            <br />

            <span class="tooltip-content">
              Failed:{{ job.failedTasksCount }}&nbsp;({{
                (job.failedTasksCount / job.numberOfTasksFragment) * 100
                  | number : "1.0-0"
              }}%)
            </span>

            <br />
            Total:{{ job.numberOfTasksFragment }}
          </span>
        </a>
      </clr-dg-cell>

      <clr-dg-cell
        id="cellstyle"
        [ngStyle]="{
          color: job.priorityFragment == 'Highest-100' ? 'red' : 'green'
        }"
        [style.width.px]="180"
        ><div class="hidden">
          <span title="{{ job.priorityFragment }}"
            >{{ job.priorityFragment }}
          </span>
        </div></clr-dg-cell
      >
      <clr-dg-cell [style.width.px]="200" id="cellstyle">{{
        job.numberOfTasksFragment
      }}</clr-dg-cell>
      <clr-dg-cell [style.width.px]="200" id="cellstyle">{{
        job.runningTasksCount
      }}</clr-dg-cell>
      <clr-dg-cell [style.width.px]="200" id="cellstyle">{{
        job.queuedTasksCount
      }}</clr-dg-cell>
      <clr-dg-cell [style.width.px]="500" id="cellstyle">
        <div class="hidden">
          <span title="{{ job.startTime | utcToLocalTime : 'short' }}"
            >{{ job.startTime | utcToLocalTime : "short" }}
          </span>
        </div></clr-dg-cell
      >
      <clr-dg-cell [style.width.px]="500" id="cellstyle">
        <div class="hidden">
          <span title="{{ job.endTime | utcToLocalTime : 'short' }}">
            {{ job.endTime | utcToLocalTime : "short" }}
          </span>
        </div></clr-dg-cell
      >
      <clr-dg-cell [style.width.px]="500" id="cellstyle"
        ><div class="hidden">
          <span title="{{ job.submitTime | utcToLocalTime : 'short' }}">
            {{ job.submitTime | utcToLocalTime : "short" }}
          </span>
        </div></clr-dg-cell
      >
      <clr-dg-cell [style.width.px]="500" id="cellstyle">{{
        job.elapsedTime
      }}</clr-dg-cell>
    </clr-dg-row>
    <ng-template
      clrIfDetail
      let-task
      (clrIfDetailChange)="onDetailOpen($event)"
    >
      <app-task-details
        [taskLayout]="this.JobDetailsLocalVariable.taskLayout"
        [JobIDFragement]="this.JobDetailsLocalVariable.SelectedJobId"
      >
      </app-task-details>
    </ng-template>
    <clr-dg-footer>
      <clr-dg-column-toggle>
        <clr-dg-column-toggle-title>Columns</clr-dg-column-toggle-title>
        <clr-dg-column-toggle-button clrType="selectAll"
          >Select all</clr-dg-column-toggle-button
        >
        <clr-dg-column-toggle-button clrType="ok"
          ><clr-icon shape="check"></clr-icon
        ></clr-dg-column-toggle-button>
      </clr-dg-column-toggle>
      <app-job-footer
        [requestFromJob]="true"
        [totalRecords]="JobDetailsLocalVariable.jobCount"
        [recordPerPagerequest]="JobDetailsLocalVariable.recordperpagejob"
        [currentPage]="JobDetailsLocalVariable.currentpage"
        [totalPage]="JobDetailsLocalVariable.totalPage"
      ></app-job-footer>
    </clr-dg-footer>
  </clr-datagrid>
</div>
